/* ==========================================================================
   Base checkbox styles
   ========================================================================== */

.checkbox {
  @apply flex gap-3 outline-none;

  cursor: var(--cursor-interactive);

  /* Align center when there's no description */
  &:not(:has([data-slot="description"])) {
    @apply items-center;
  }

  /* Align start when there's a description */
  &:has([data-slot="description"]) {
    @apply items-start;
  }

  [data-slot="label"] {
    @apply select-none;
  }

  [data-slot="description"] {
    @apply select-none text-wrap;
  }

  /* Disabled state */
  &:disabled,
  &[data-disabled],
  &[aria-disabled] {
    @apply status-disabled;
  }

  /* Indicator styles */
  &[data-selected],
  &[data-indeterminate] {
    .checkbox__indicator {
      border-color: var(--accent-foreground);
      background: var(--accent-hover);
    }
  }

  /* Checkmark SVG indicator */
  [data-slot="checkbox-default-indicator--checkmark"] {
    @apply text-accent-foreground size-2.5;

    /**
     * Transitions
     */
    @apply transition-all duration-200 motion-reduce:transition-none;
  }

  &[data-selected] [data-slot="checkbox-default-indicator--checkmark"] {
    transition: stroke-dashoffset 250ms linear 150ms;
  }

  /* Invalid + Selected: checkmark icon color */
  &[data-invalid][data-selected] [data-slot="checkbox-default-indicator--checkmark"],
  &[data-invalid][aria-checked] [data-slot="checkbox-default-indicator--checkmark"],
  &[aria-invalid][data-selected] [data-slot="checkbox-default-indicator--checkmark"],
  &[aria-invalid][aria-checked] [data-slot="checkbox-default-indicator--checkmark"] {
    @apply text-danger-foreground;
  }

  /* Indeterminate line indicator */
  &[data-indeterminate] {
    [data-slot="checkbox-default-indicator--indeterminate"] {
      @apply size-3;
    }
  }

  /* Invalid + Indeterminate: indeterminate icon color */
  &[data-indeterminate][data-invalid] [data-slot="checkbox-default-indicator--indeterminate"],
  &[data-indeterminate][aria-invalid] [data-slot="checkbox-default-indicator--indeterminate"] {
    @apply text-danger-foreground;
  }
}

/* ==========================================================================
   Checkbox control (the square button)
   ========================================================================== */

.checkbox__control {
  @apply bg-field shadow-field relative inline-flex size-4 shrink-0 items-center justify-center overflow-hidden rounded-md outline-none;

  /**
   * Transitions
   * CRITICAL: motion-reduce must be AFTER transition for correct override specificity
   */
  transition:
    background-color 250ms var(--ease-out),
    transform 250ms var(--ease-out-quart);
  @apply motion-reduce:transition-none;

  cursor: var(--cursor-interactive);

  /* Add top margin when there's a description */
  .checkbox:has([data-slot="description"]) & {
    @apply mt-0.5;
  }

  /* Background indicator pseudo-element */
  &::before {
    @apply bg-accent pointer-events-none absolute inset-0 z-0 origin-center scale-50 rounded-md opacity-0 content-[''];

    /**
     * Transitions
     * CRITICAL: motion-reduce must be AFTER transition for correct override specificity
     */
    transition:
      scale 200ms var(--ease-linear),
      opacity 200ms var(--ease-linear),
      background-color 200ms var(--ease-out);
    @apply motion-reduce:transition-none;
  }

  /* Interactive states */
  /* Focus */
  .checkbox:focus-visible &,
  .checkbox[data-focus-visible] & {
    @apply status-focused;
  }

  /* Hover */
  .checkbox:hover &,
  .checkbox[data-hovered] & {
    @apply border-field-border-hover;

    &::before {
      @apply bg-accent-hover;
    }
  }

  /* Pressed */
  .checkbox:active &,
  .checkbox[data-pressed] & {
    @apply scale-95;
  }

  /* Selection states */
  /* Selected */
  .checkbox[aria-checked] &,
  .checkbox[data-selected] & {
    @apply text-accent-foreground border-transparent;

    &::before {
      @apply scale-100 opacity-100;
    }
  }

  /* Indeterminate */
  .checkbox[data-indeterminate] & {
    @apply bg-accent text-accent-foreground;
  }

  /* Indeterminate + Pressed */
  .checkbox:active[data-indeterminate] &,
  .checkbox[data-pressed][data-indeterminate] & {
    @apply bg-accent-hover;
  }

  /* Validation states */
  /* Invalid (only when not selected/indeterminate) */
  .checkbox[data-invalid]:not([aria-checked]):not([data-selected]):not([data-indeterminate]) &,
  .checkbox[aria-invalid]:not([aria-checked]):not([data-selected]):not([data-indeterminate]) & {
    @apply status-invalid-field;
  }

  /* Invalid + Selected */
  .checkbox[data-invalid][aria-checked] &,
  .checkbox[data-invalid][data-selected] &,
  .checkbox[aria-invalid][aria-checked] &,
  .checkbox[aria-invalid][data-selected] & {
    @apply bg-danger text-danger-foreground border-transparent;

    &::before {
      @apply bg-danger scale-100 opacity-100;
    }
  }

  /* Invalid + Indeterminate */
  .checkbox[data-indeterminate][aria-invalid] &,
  .checkbox[data-indeterminate][data-invalid] & {
    @apply bg-danger text-danger-foreground;
  }
}

/* ==========================================================================
   Checkbox indicator
   ========================================================================== */

.checkbox__indicator {
  @apply relative z-10 flex size-3 items-center justify-center;
}

/* ==========================================================================
   Checkbox content wrapper
   ========================================================================== */

.checkbox__content {
  @apply flex flex-col gap-0;
}

/* ==========================================================================
   Disabled modifier
   ========================================================================== */

.checkbox--disabled {
  @apply status-disabled;
}

/* ==========================================================================
   On Surface variant
   ========================================================================== */

.checkbox--on-surface .checkbox__control {
  @apply shadow-none;
}

.checkbox--on-surface:not([aria-checked]):not([data-selected]):not([data-indeterminate])
  .checkbox__control {
  @apply bg-on-surface;
}

/* Selected state on surface */
.checkbox--on-surface[aria-checked] .checkbox__control,
.checkbox--on-surface[data-selected] .checkbox__control {
  &::before {
    @apply bg-accent;
  }
}

/* Indeterminate state on surface */
.checkbox--on-surface[data-indeterminate] .checkbox__control {
  @apply bg-accent;

  &::before {
    @apply bg-accent;
  }
}

.checkbox--on-surface .checkbox__control {
  /* Hover state */
  .checkbox:hover &,
  .checkbox[data-hovered] & {
    @apply border-field-border-hover;
  }
}
